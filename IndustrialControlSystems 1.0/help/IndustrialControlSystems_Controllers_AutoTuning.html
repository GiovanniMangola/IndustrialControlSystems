<HTML>
<HEAD>
<TITLE>IndustrialControlSystems.Controllers.AutoTuning</TITLE>
<META name="HTML-Generator" content="Dymola">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<META name="description" content="&quot;Automatic Tuning controllers&quot;">
<style type="text/css">
*       { font-size: 10pt; font-family: Arial,sans-serif; }
pre     { font-size:  9pt; font-family: Courier,monospace;}
h4      { font-size: 10pt; font-weight: bold; color: green; }
h3      { font-size: 11pt; font-weight: bold; color: green; }
h2      { font-size: 13pt; font-weight: bold; color: green; }
address {                  font-weight: normal} 
td      { solid #000; vertical-align:top; }
th      { solid #000; vertical-align:top; font-weight: bold; }
table   { solid #000; border-collapse: collapse;}
</style>
</HEAD>
<BODY><P>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE AutoTuning<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><A NAME="IndustrialControlSystems.Controllers.AutoTuning"></A><A HREF="IndustrialControlSystems_Controllers.html#IndustrialControlSystems.Controllers"
>IndustrialControlSystems.Controllers</A>.AutoTuning</H2>
<B>Automatic Tuning controllers</B>
<P>
<P><H3>Information</H3></P>
<PRE>
  </pre>
  <h4>Description</h4>
  <p>
  This sub-packege contains some controllers with automatic tuning features.<br>
  </p>
  <pre></PRE><P>
Extends from Modelica.Icons.Package (Icon for standard packages).
<P><H3>Package Content</H3><p>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
<TR><TH >Name</TH><TH>Description</TH></TR>
<TR><TD><IMG SRC="IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCdigitalS.png" ALT="IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCdigital" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="IndustrialControlSystems_Controllers_AutoTuning.html#IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCdigital"
>ATPIrelayNCdigital</A>
</TD><TD>PI controller with Auto Tuning algorithm - discrete time version -</TD></TR>
<TR><TD><IMG SRC="IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCdigitalS.png" ALT="IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCmixedMode" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="IndustrialControlSystems_Controllers_AutoTuning.html#IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCmixedMode"
>ATPIrelayNCmixedMode</A>
</TD><TD>PI controller with Auto Tuning algorithm - mixed continuous/discrete time version -</TD></TR>
<TR><TD><IMG SRC="IndustrialControlSystems.Controllers.AutoTuning.ExamplesS.png" ALT="IndustrialControlSystems.Controllers.AutoTuning.Examples" WIDTH=20  HEIGHT=20 ALIGN = TOP >&nbsp;<A HREF="IndustrialControlSystems_Controllers_AutoTuning_Examples.html#IndustrialControlSystems.Controllers.AutoTuning.Examples"
>Examples</A>
</TD><TD>Examples</TD></TR>
</TABLE>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE ATPIrelayNCdigital<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCdigitalI.png" ALT="IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCdigital" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCdigital"></A><A HREF="IndustrialControlSystems_Controllers_AutoTuning.html#IndustrialControlSystems.Controllers.AutoTuning"
>IndustrialControlSystems.Controllers.AutoTuning</A>.ATPIrelayNCdigital</H2>
<B>PI controller with Auto Tuning algorithm - discrete time version -</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
  <h4>Description</h4>
  <p>
  Proportional + Integral controller with AutoTuning, Automatic, Tracking mode and bias signal.<br/>
  The control law is defined as
  <pre>
              1+sTi 
  CS(s) = Kp ------- (SP(s) - PV(S))
               sTi
  </pre>
  <br/><br/>
  <b>Scheme</b><br/><br/>
  <img src="images/Controllers/PropInt.png">
  <br/><br/>
  <TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
  <TR bgcolor=#e0e0e0><TH >Name</TH><TH>Description</TH><TH>Conditional?</TH></TR>
  <tr>  <td>SP</td><td>Set Point</td><td>NO</td></tr>
  <tr>  <td>PV</td><td>Process Variable</td><td>NO</td></tr>
  <tr>  <td>CS</td><td>Control Signal</td><td>NO</td></tr>
  <tr>  <td>TR</td><td>Track Reference signal</td><td>YES (useTS)</td></tr>
  <tr>  <td>TS</td><td>Track Switch signal</td><td>YES (useTS)</td></tr>
  <tr>  <td>Bias</td><td>Biasing signal</td><td>YES (useBIAS)</td></tr>
  <tr>  <td>ATreq</td><td>AutoTuning request</td><td>YES (useAT)</td></tr>
  </table><br/><br/>
  The controller can have various operating conditions:
  <ul>
  <li>Automatic,</li>
  <li>Auto Tuning,</li>
  <li>and Tracking</li>
  </ul><br/>
  
  In the Automatic mode, the control output is computed with the proportional+integral control law, while in the tracking mode<br>
  it is defined by the input TR.<br/><br/>
  </p>
  <h4>Auto Tuning</h4>
  <p>
  This section presents the Modelica realisations of the fully digital of the considered autotuning methodology.

  The block inputs are the set point (SP) and the process variable (PV), plus a boolean one, a pulse on which
  initiates the autotuning procedure; the output is clearly the control signal (CS).
  The initial values for K and Ti, as well as the required phase margin pm, are provided as parameters.
  
  The autotuning procedure is composed of the following steps:
  <ul>
  <li>start with the controller in PI mode;</li>
  <li>when the AT pulse is received,</li>
        <ul>
        <li>initialise the relay plus integrator control,</li>
        <li>connect it to the process,</li>
        <li>and wait for a permanent oscillation;</li>
        </ul>
        in the quite simple procedure presented here, an oscillation is considered permanent when the 
        difference between its period and that of the previous one is less than a percent defined as parameter,
        while - for the sake of safety in the face of possible outliers - a certain number of oscillations, 
        defined as a parameter too, is counted unconditionally before proceeding;</li>
  <li>when a permanent oscillation is detected, compute its frequency (wox), and by means of the following equation
  determine the corresponding process frequency response magnitude (the phase is -90 degrees);
  <br><pre>
  Pox    := pi^2*(rPVmax-rPVmin)/8/(rCSmax-rCSmin)
  </pre>
  </li>
  <li>apply equations
  <br><pre>
  TI     := tan(pm/180*pi)/wox
  K      := tan(pm/180*pi)/(Pox*sqrt(1+(tan(pm/180*pi))^2))
  </pre>
  to tune the regulator, and finally switch back to PI mode.</li>
  </ul><br><br>
  It is worth noticing that any industrial realisation would be more articulated than those illustrated in the following.
  For example, some logic would need introducing to abort the procedure in the case of unexpected and/or possibly harmful 
  system behaviours, a confirmation should be requested to the operator in order to accept or decline the proposed
  parameters prior to updating the PI, and so forth. Such features are however omitted here since they are lengthy to
  discuss in the necessary detail, and substantially inessential for the purpose of this work.
  <br>
  <h4>References</h4>
  For more information please refers to the following
  <a href="/home/marco/Dropbox/ControlLibrary/finalVersion/IndustrialControlSystems/help/refs/EffHybPITuning.pdf">paper</a>:<br><br>
  <b>Efficient hybrid simulation of autotuning PI controllers</b><br>
  Alberto Leva, Marco Bonvini<br>
  8th Modelica Conference, Dresden, Germany<br>
  march 20-22, 2011<br>
  </p>
    <pre></PRE><P>
Extends from <A HREF="IndustrialControlSystems_Controllers_Interfaces.html#IndustrialControlSystems.Controllers.Interfaces.Controller"
>IndustrialControlSystems.Controllers.Interfaces.Controller</A> (Partial interface for a generic controller).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Kp</TD><TD> Proportional gain (initial value)</TD></TR>
<TR><TD>Ti</TD><TD> Integral time (initial value)</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=2>Discretisation</TD></TR>
<TR><TD>Ts</TD><TD> Sampling time (if &lt;= 0 continuous time)</TD></TR>
<TR><TD>method</TD><TD> Discretisation method</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=2>Saturation</TD></TR>
<TR><TD>AntiWindup</TD><TD> Flag that enables the antiwindup feature</TD></TR>
<TR><TD>CSmin</TD><TD> minimum value of the CS</TD></TR>
<TR><TD>CSmax</TD><TD> maximum value of the CS</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=2>Initialisation</TD></TR>
<TR><TD>CS_start</TD><TD> output initial value</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=2>Attributes</TD></TR>
<TR><TD>eps</TD><TD> small time constant that represents the time for switching 
                            between auto and tracking mode</TD></TR>
<TR><TD>useTS</TD><TD> =true, if TS and TR inputs are enabled</TD></TR>
<TR><TD>useBIAS</TD><TD> =true, if BIAS input is enabled</TD></TR>
<TR><TD>useAT</TD><TD> =true, if AutoTuning input is enabled</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=2>Auto Tuning Algorithm</TD></TR>
<TR><TD>slope</TD><TD> Slope of the signal</TD></TR>
<TR><TD>permOxPeriodPerc</TD><TD> allowed % difference between period measurements</TD></TR>
<TR><TD>pm</TD><TD> Phase Margin required</TD></TR>
<TR><TD>nOxMin</TD><TD> minimum number of oscillations</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>TR</TD><TD>Track Reference signal</TD></TR>
<TR><TD>TS</TD><TD>Track Switch signal</TD></TR>
<TR><TD>BIAS</TD><TD>Bias</TD></TR>
<TR><TD>SP</TD><TD>Set Point signal</TD></TR>
<TR><TD>CS</TD><TD>Control signal</TD></TR>
<TR><TD>PV</TD><TD>Process Variable signal</TD></TR>
<TR><TD>ATreq</TD><TD>Auto Tuning request</TD></TR>
</TABLE>
<!--[if supportFields]><span style='mso-element:field-begin'></span>
<span style='mso-spacerun:yes'></span>XE ATPIrelayNCmixedMode<![endif]-->
<!--[if supportFields]><span style='mso-element:field-end'></span><![endif]-->
<H2><IMG SRC="IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCdigitalI.png" ALT="IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCmixedMode" ALIGN=RIGHT BORDER=1 WIDTH=80  HEIGHT=80 >
<A NAME="IndustrialControlSystems.Controllers.AutoTuning.ATPIrelayNCmixedMode"></A><A HREF="IndustrialControlSystems_Controllers_AutoTuning.html#IndustrialControlSystems.Controllers.AutoTuning"
>IndustrialControlSystems.Controllers.AutoTuning</A>.ATPIrelayNCmixedMode</H2>
<B>PI controller with Auto Tuning algorithm - mixed continuous/discrete time version -</B><p>
<P><H3>Information</H3></P>
<PRE></pre>
  <h4>Description</h4>
  <p>
  Proportional + Integral controller with AutoTuning, Automatic, Tracking mode and bias signal.<br/>
  The control law is defined as
  <pre>
              1+sTi 
  CS(s) = Kp ------- (SP(s) - PV(S))
               sTi
  </pre>
  <br/><br/>
  <b>Scheme</b><br/><br/>
  <img src="images/Controllers/PropInt.png">
  <br/><br/>
  <TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2 >
  <TR bgcolor=#e0e0e0><TH >Name</TH><TH>Description</TH><TH>Conditional?</TH></TR>
  <tr>  <td>SP</td><td>Set Point</td><td>NO</td></tr>
  <tr>  <td>PV</td><td>Process Variable</td><td>NO</td></tr>
  <tr>  <td>CS</td><td>Control Signal</td><td>NO</td></tr>
  <tr>  <td>TR</td><td>Track Reference signal</td><td>YES (useTS)</td></tr>
  <tr>  <td>TS</td><td>Track Switch signal</td><td>YES (useTS)</td></tr>
  <tr>  <td>Bias</td><td>Biasing signal</td><td>YES (useBIAS)</td></tr>
  <tr>  <td>ATreq</td><td>AutoTuning request</td><td>YES (useAT)</td></tr>
  </table><br/><br/>
  The controller can have various operating conditions:
  <ul>
  <li>Automatic,</li>
  <li>Auto Tuning,</li>
  <li>and Tracking</li>
  </ul><br/>
  
  In the Automatic mode, the control output is computed with the proportional+integral control law, while in the tracking mode<br>
  it is defined by the input TR.<br/><br/>
  </p>
  <h4>Auto Tuning</h4>
  <p>
  This section presents the Modelica realisations of the fully digital of the considered autotuning methodology.

  The block inputs are the set point (SP) and the process variable (PV), plus a boolean one, a pulse on which
  initiates the autotuning procedure; the output is clearly the control signal (CS).
  The initial values for K and Ti, as well as the required phase margin pm, are provided as parameters.
  
  The autotuning procedure is composed of the following steps:
  <ul>
  <li>start with the controller in PI mode;</li>
  <li>when the AT pulse is received,</li>
        <ul>
        <li>initialise the relay plus integrator control,</li>
        <li>connect it to the process,</li>
        <li>and wait for a permanent oscillation;</li>
        </ul>
        in the quite simple procedure presented here, an oscillation is considered permanent when the 
        difference between its period and that of the previous one is less than a percent defined as parameter,
        while - for the sake of safety in the face of possible outliers - a certain number of oscillations, 
        defined as a parameter too, is counted unconditionally before proceeding;</li>
  <li>when a permanent oscillation is detected, compute its frequency (wox), and by means of the following equation
  determine the corresponding process frequency response magnitude (the phase is -90 degrees);
  <br><pre>
  Pox    := pi^2*(rPVmax-rPVmin)/8/(rCSmax-rCSmin)
  </pre>
  </li>
  <li>apply equations
  <br><pre>
  TI     := tan(pm/180*pi)/wox
  K      := tan(pm/180*pi)/(Pox*sqrt(1+(tan(pm/180*pi))^2))
  </pre>
  to tune the regulator, and finally switch back to PI mode.</li>
  </ul><br><br>
  It is worth noticing that any industrial realisation would be more articulated than those illustrated in the following.
  For example, some logic would need introducing to abort the procedure in the case of unexpected and/or possibly harmful 
  system behaviours, a confirmation should be requested to the operator in order to accept or decline the proposed
  parameters prior to updating the PI, and so forth. Such features are however omitted here since they are lengthy to
  discuss in the necessary detail, and substantially inessential for the purpose of this work.
  
  <h4>Mixed Mode</h4>
  When everything is digital, things are simple, and the only issue to care about is to correctly manage the regulator tracking
  while the relay is driving the control signal so as to achieve the required permanent oscillation. If conversely one wants to 
  represent the controller as a continuous-time system, it is necessary to suitably coordinate it with the digital procedure.

  The solution adopted here can be summarised as follows. First, implement the controller in the desired form (here, for consistence 
  with the digital case, an antiwindup PI was chosen) as differential and algebraic equations. Then, realise the autotuning procedure 
  as a digital algorithm, including the control computation during that procedure, exactly as it was in the fully digital case. 
  Finally, manage the autotuning request event by (a) setting a flag that selects the control output to be that coming from the 
  equations or the algorithm, depending on the mode, and (b) initialising the algorithm output to the last equation output. 
  Analogously, manage the autotuning termination by resetting the above flag, and reinitialising the equation-based controller state 
  to match the last algorithm output.

  The only (small) disadvantage of such a solution is that the equation-based controller stays in place during the autotuning phase. 
  However the resulting overhead is generally very limited, given the invariantly simple structure of the controller, while there is 
  a gain in terms of simplicity with respect to possible alternative solutions attempting to avoid said overhead.
  <br>
  <h4>References</h4>
  For more information please refers to the following
  <a href="/home/marco/Dropbox/ControlLibrary/finalVersion/IndustrialControlSystems/help/refs/EffHybPITuning.pdf">paper</a>:<br><br>
  <b>Efficient hybrid simulation of autotuning PI controllers</b><br>
  Alberto Leva, Marco Bonvini<br>
  8th Modelica Conference, Dresden, Germany<br>
  march 20-22, 2011<br>
  </p>
    <pre></PRE><P>
Extends from <A HREF="IndustrialControlSystems_Controllers_Interfaces.html#IndustrialControlSystems.Controllers.Interfaces.Controller"
>IndustrialControlSystems.Controllers.Interfaces.Controller</A> (Partial interface for a generic controller).
<P><H3>Parameters</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>Kp</TD><TD> Proportional gain (initial value)</TD></TR>
<TR><TD>Ti</TD><TD> Integral time (initial value)</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=2>Discretisation</TD></TR>
<TR><TD>Ts</TD><TD> Sampling time (if &lt;= 0 continuous time)</TD></TR>
<TR><TD>method</TD><TD> Discretisation method</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=2>Saturation</TD></TR>
<TR><TD>AntiWindup</TD><TD> Flag that enables the antiwindup feature</TD></TR>
<TR><TD>CSmin</TD><TD> minimum value of the CS</TD></TR>
<TR><TD>CSmax</TD><TD> maximum value of the CS</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=2>Initialisation</TD></TR>
<TR><TD>CS_start</TD><TD> output initial value</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=2>Attributes</TD></TR>
<TR><TD>eps</TD><TD> small time constant that represents the time for switching 
                            between auto and tracking mode</TD></TR>
<TR><TD>useTS</TD><TD> =true, if TS and TR inputs are enabled</TD></TR>
<TR><TD>useBIAS</TD><TD> =true, if BIAS input is enabled</TD></TR>
<TR><TD>useAT</TD><TD> =true, if AutoTuning input is enabled</TD></TR>
<TR bgcolor="#e0e0e0"><TD colspan=2>Auto Tuning Algorithm</TD></TR>
<TR><TD>slope</TD><TD> Slope of the signal</TD></TR>
<TR><TD>permOxPeriodPerc</TD><TD> allowed % difference between period measurements</TD></TR>
<TR><TD>pm</TD><TD> Phase Margin required</TD></TR>
<TR><TD>nOxMin</TD><TD> minimum number of oscillations</TD></TR>
</TABLE>
<P><H3>Connectors</H3><P>
<TABLE BORDER=1 CELLSPACING=0 CELLPADDING=2>
<TR><TH>Name</TH><TH>Description</TH></TR>
<TR><TD>TR</TD><TD>Track Reference signal</TD></TR>
<TR><TD>TS</TD><TD>Track Switch signal</TD></TR>
<TR><TD>BIAS</TD><TD>Bias</TD></TR>
<TR><TD>SP</TD><TD>Set Point signal</TD></TR>
<TR><TD>CS</TD><TD>Control signal</TD></TR>
<TR><TD>PV</TD><TD>Process Variable signal</TD></TR>
<TR><TD>ATreq</TD><TD>Auto Tuning request</TD></TR>
</TABLE>
<address><a href="http://www.3ds.com/">Automatically generated</a> Mon May 21 13:34:16 2012.
</address></BODY>
</HTML>
